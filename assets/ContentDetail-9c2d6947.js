import{r as t,j as e,a as q,_ as f,P as C,n as H,b as V,L as W}from"./vendor-d0eccd61.js";import{p as y,u as Q}from"./index-643c04aa.js";import{P as X}from"./PageHead-9dd9e60a.js";import{d as Y}from"./debounce-1252dfff.js";import{g as Z}from"./getPbImageURL-68fee321.js";const{kakao:S}=window;function P({address:s="제주특별자치도 제주시 공항로 2",location:l="제주국제공항"}){return t.useEffect(()=>{var a=document.getElementById("map"),u={center:new S.maps.LatLng(33.450701,126.570667),level:3},r=new S.maps.Map(a,u),b=new S.maps.services.Geocoder;b.addressSearch(s,function(i,m){if(m===S.maps.services.Status.OK){var p=new S.maps.LatLng(i[0].y,i[0].x),w=new S.maps.Marker({map:r,position:p}),v=new S.maps.InfoWindow({content:`<div style="width:150px;text-align:center;padding:6px 0;">${l}</div>`});v.open(r,w),r.setCenter(p)}})},[s,l]),e.jsx(e.Fragment,{children:e.jsx("article",{id:"map",className:"h-96 mx-[15%] my-10"})})}P.propTypes={address:q.string,location:q.string};const ee="/finalize-react-6/assets/more-5d1bd5d3.svg";function L({writer:s="작성자",comment:l="댓글입니다",commentId:a,onCommentChange:u}){const[r,b]=t.useState(!1),[i,m]=t.useState(!1),[p,w]=t.useState(l),[v,c]=t.useState(l),[x]=t.useState(()=>{const g=localStorage.getItem("user");return JSON.parse(g).state.user.username}),d=()=>{b(!r)},o=()=>{if(x!==s){f("작성자만 수정 가능합니다.",{position:"top-right",icon:"🚨",ariaProps:{role:"alert","aria-live":"polite"}});return}b(!1),m(!0)},j=async g=>{const h={comment:p};try{await y.collection("comment").update(g,h)}catch(N){throw new Error(N.message)}m(!1)},O=()=>{m(!1),w(v)},k=async g=>{if(b(!1),x!==s){f("작성자만 삭제 가능합니다.",{position:"top-right",icon:"🚨",ariaProps:{role:"alert","aria-live":"polite"}});return}f.custom(h=>e.jsx("div",{className:`${h.visible?"animate-enter":"animate-leave"} max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:e.jsxs("div",{className:"w-full flex flex-col p-5 text-center gap-10",children:[e.jsx("p",{className:"font-semibold text-lg mt-4",children:"댓글을 삭제하시겠습니까 ?"}),e.jsxs("div",{className:"flex justify-center items-center gap-5",children:[e.jsx("button",{onClick:async()=>{try{await y.collection("comment").delete(g),f.remove(h.id),u(N=>N.filter(T=>T.id!==g))}catch(N){console.error(N)}},className:"bg-lightblue focus:bg-blue text-center text-white rounded-lg px-4 py-3 leading-none",children:"삭제"}),e.jsx("button",{onClick:()=>f.remove(h.id),className:"bg-lightblue focus:bg-blue text-center text-white rounded-lg px-4 py-3 leading-none",children:"취소"})]})]})}),{duration:1/0})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"shadow-comment w-full h-fit flex justify-between gap-4 py-3 px-4",children:[e.jsx("span",{children:"⭐"}),e.jsx("div",{className:"text-darkblue font-semibold  ",children:s}),i?e.jsx("input",{type:"text",value:p,className:"grow text-start bg-lightsand",onChange:g=>w(g.target.value)}):e.jsx("p",{className:"grow text-start",children:p}),e.jsxs("button",{onClick:d,className:"shrink-0",children:[e.jsx("img",{src:ee,alt:"more"}),r&&e.jsx("ul",{className:"dropdown-menu",children:i?e.jsxs(e.Fragment,{children:[e.jsx("li",{onClick:()=>j(a),children:"저장"}),e.jsx("li",{onClick:()=>O(),children:"취소"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{onClick:()=>o(),children:"수정"}),e.jsx("li",{onClick:()=>k(a),children:"삭제"})]})},a)]})]})})}L.propTypes={writer:C.string.isRequired,comment:C.string.isRequired,commentId:C.string.isRequired,onCommentChange:C.func.isRequired};function D({contentId:s,onCommentInfoChange:l}){const[a,u]=t.useState(""),[r,b]=t.useState(""),i=t.useRef(""),[m]=t.useState(()=>{const c=localStorage.getItem("user");return JSON.parse(c).state.user.userId}),p=async()=>(await y.collection("user").getList(1,1,{expand:"comment, content",filter:`(username = '${m}')`})).items[0].id,w=Y(c=>{u(c.target.value)},500),v=async c=>{if(c.preventDefault(),!i.current.value.trim()){f("댓글을 입력해주세요.",{position:"top-right",icon:"🚨",ariaProps:{role:"alert","aria-live":"polite"}});return}if(!m){f("로그인 후 이용 가능합니다.",{position:"top-right",icon:"🚨",ariaProps:{role:"alert","aria-live":"polite"}});return}const x=await p();b(x)};return t.useEffect(()=>{if(r){const c=async o=>await y.collection("user").update(r,{"comment+":o.id}),x=async o=>await y.collection("content").update(s,{"commentId+":o.id}),d=async()=>{const o={star:!0,comment:a,contentId:s,userId:r};if(i.current.value.trim()){const j=await y.collection("comment").create(o,{expand:"userId"});u(""),i.current.value="",await x(j),await c(j),l==null||l(j)}};try{d()}catch(o){console.error(o)}}},[r,s,l,a]),e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:v,className:"grow w-full flex",children:[e.jsxs("div",{className:"flex-grow mr-2",children:[e.jsx("label",{htmlFor:"comment",className:"sr-only",children:"댓글"}),e.jsx("input",{type:"text",id:"comment",name:"comment",ref:i,defaultValue:a,placeholder:"별과 함께 이 제주에 대한 마음을 입력해주세요.",onChange:w,required:!0,className:"w-full py-3 px-4 border-2 rounded-md border-lightblue focus:outline-none focus:border-blue"})]}),e.jsx("button",{type:"submit",className:"min-w-fit px-4 py-3 bg-lightblue hover:bg-blue border-2 text-white font-bold border-lightsand rounded-md",children:"⭐ 마음 등록"})]})})}D.propTypes={contentId:C.string.isRequired,onCommentInfoChange:C.func.isRequired};function ie(){const{id:s}=H(),l=V(),{user:a}=Q(),[u,r]=t.useState(),[b,i]=t.useState(),[m,p]=t.useState(),[w,v]=t.useState(),[c,x]=t.useState(),[d,o]=t.useState([]),[j,O]=t.useState(),[k,g]=t.useState(),h=t.useRef(null),[N,T]=t.useState(),[te,F]=t.useState(),[R,$]=t.useState();t.useEffect(()=>{R&&o(n=>[...n,R])},[R]);const[M,se]=t.useState([]),U=n=>M.includes(n);t.useEffect(()=>{async function n(){try{const I=await y.collection("content").getOne(s,{expand:"commentId,commentId.userId,userId"},{requestKey:"string"}),{title:J,content:K,tag:_,customTag:z,expand:E,location:B,address:G}=I;p(Z(I,"photo")),i(K),v(_),r(J),O(B),g(G),x(z),T(s),F(I),E&&o(E.commentId),E&&(h.current=E.userId.username)}catch(I){console.error(I)}}n()},[s]);const A=async()=>{f.custom(n=>e.jsx("div",{className:`${n.visible?"animate-enter":"animate-leave"} max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:e.jsxs("div",{className:"w-full flex flex-col p-5 text-center gap-10",children:[e.jsx("p",{className:"font-semibold text-lg mt-4",children:"게시물을 삭제하시겠습니까 ?"}),e.jsxs("div",{className:"flex justify-center items-center gap-5",children:[e.jsx("button",{onClick:async()=>{try{await y.collection("content").delete(s),f.remove(n.id),l("/content/list")}catch(I){console.error(I)}},className:"bg-lightblue focus:bg-blue text-center text-white rounded-lg px-4 py-3 leading-none",children:"삭제"}),e.jsx("button",{onClick:()=>f.remove(n.id),className:"bg-lightblue focus:bg-blue text-center text-white rounded-lg px-4 py-3 leading-none",children:"취소"})]})]})}),{duration:1/0})};return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Jeju All in One - 나만의 제주"}),e.jsxs("section",{className:"shadow-content mt-5 mb-20 px-20 py-20 gap-5 flex flex-col items-center mx-[15%] min-h-full rounded-md",children:[e.jsx("h2",{className:"sr-only",children:u}),e.jsx("article",{className:"min-w-[400px] ",children:e.jsx("img",{src:m,alt:u,className:"w-full h-full object-cover max-h-[100vh]"})}),e.jsxs("article",{className:"w-full py-2 px-4 rounded-md border border-gray-500",children:[e.jsxs("p",{className:"pb-2 font-bold flex justify-between",children:[u,e.jsxs("span",{className:"font-light",children:["#",w," ",c&&`#${c}`]})]}),b]}),h.current!==null&&h.current===(a==null?void 0:a.userId)&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{to:`/content/edit/${s}`,children:e.jsx("button",{className:"bg-blue text-white py-2 px-4 rounded-lg",children:"수정"})}),e.jsx("button",{className:"bg-blue text-white py-2 px-4 rounded-lg",onClick:A,children:"삭제"})]})]}),e.jsx("hr",{className:"hr h-2 border-2"}),e.jsxs("section",{className:"py-20 flex flex-col justify-center text-center items-center mx-auto min-h-full max-w-[1200px]",children:[e.jsx("div",{className:"w-full flex flex-row gap-4 justify-between items-center px-[15%]",children:e.jsx(D,{contentId:s,onCommentInfoChange:$})}),(d==null?void 0:d.length)!==0&&e.jsx("div",{className:"w-full flex flex-col pt-10 px-[15%]",children:d==null?void 0:d.map(n=>U(n.id)?null:e.jsx(L,{writer:n.expand.userId.nickname,comment:n.comment,commentId:n.id,onCommentChange:o},n.id))})]}),e.jsx("hr",{}),e.jsx(P,{address:k&&k!=="null"?k:"제주특별자치도 제주시 공항로 2",location:j&&j!=="null"?j:"제주국제공항"})]})}export{ie as default};
