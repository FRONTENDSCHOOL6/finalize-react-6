import{b as _,n as z,r as t,j as e,o as C}from"./vendor-d0eccd61.js";import{p as v}from"./index-dc9dba68.js";import{S as H,c as J,M as K}from"./Map-13e4ed57.js";import{P as $}from"./PageHead-9dd9e60a.js";import{C as k,c as f}from"./data-5142d5c3.js";import{g as B}from"./getPbImageURL-68fee321.js";v.autoCancellation(!1);const s={title:"",content:"",photo:"",tag:"",customTag:"",comment:"",location:"",address:""};function ee(){const I=_(),{id:g}=z(),[r,P]=t.useState(null),[y,F]=t.useState([]),[N,w]=t.useState(),[E,V]=t.useState(),[R,A]=t.useState(),D=t.useRef(null),x=t.useRef(null),h=t.useRef(null),c=t.useRef(null),u=t.useRef(null),S=t.useRef(null),i=t.useRef(null),m=t.useRef(null);t.useLayoutEffect(()=>{async function a(){try{const n=await v.collection("content").getOne(g,{expand:"userId"},{requestKey:"string"}),{title:p,content:o,tag:d,customTag:b,location:l,address:j}=n;s.title=x.current.value=p,s.content=h.current.value=o,s.customTag=c.current.value=b;const T=s.photo=B(n,"photo");P({image:T,label:T}),s.tag=u.current.value=d,A(f.findIndex(q=>q.value==d)),s.location=i.current.value=l,s.address=m.current.value=j}catch(n){n in DOMException||console.error()}}a()},[g]),t.useEffect(()=>{w(i.current)},[m,i]);const O=a=>{const{files:n}=a.target,p=Array.from(n).map(o=>({image:URL.createObjectURL(o),label:o.name}));F(p)},U=async a=>{a.preventDefault();const n=x.current.value,p=h.current.value,o=S.current.files,d=u.current.value,b=c.current.value;u||C("태그를 선택해주세요.",{position:"top-center",icon:"🚨",ariaProps:{role:"alert","aria-live":"polite"}}),!r&&o.length<=0&&C("사진을 등록해주세요.",{position:"top-center",icon:"🚨",ariaProps:{role:"alert","aria-live":"polite"}});const l=new FormData;l.append("title",n),l.append("content",p),l.append("location",i.current),l.append("address",m.current),l.append("tag",d),l.append("customTag",b),o.length>0&&l.append("photo",o[0]);try{await v.collection("content").update(g,l),I("/content/list")}catch(j){console.error(j)}},L=()=>{c.current.value=c.current.value.replace(/(\s+)/g,"_")},M=a=>{u.current.value=a.value};return e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Jeju All in One - 나만의 제주"}),e.jsx(k,{title:"제주, 나의 ⭐"}),e.jsx("form",{encType:"multipart/form-data",ref:D,onSubmit:U,className:"flex flex-col gap-2 items-center",children:e.jsxs("div",{className:"flex w-4/5 gap-6 mx-auto px-10 mt-10 mb-32 min-w-[1000px]",children:[e.jsxs("div",{className:"relative w-full flex-grow",children:[e.jsx("label",{htmlFor:"photo",className:"sr-only",children:"사진 등록"}),e.jsx("input",{type:"file",accept:"image/jpg,image/png,image/jpeg,image/webp,image/avif",name:"photo",id:"photo",ref:S,onChange:O,className:"absolute w-full h-full opacity-0 cursor-pointer"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto p-2 w-full min-w-[350px] h-full bg-slate-100",children:!y.length&&r?e.jsx("img",{src:r.image,alt:r.label,className:"m-auto bg-slate-100 max-h-[660px]"},r.label):y.map(a=>e.jsx("img",{src:a.image,alt:a.label,className:"m-auto bg-slate-100 max-h-[660px]"},a.label))})]}),e.jsxs("div",{className:"w-full flex flex-col gap-2 flex-grow",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"title",className:"sr-only",children:"제목"}),e.jsx("input",{type:"text",id:"title",name:"title",placeholder:"제목을 입력해주세요",ref:x,className:"w-full py-3 px-4 border rounded-md border-gray-300 focus:outline-none focus:border-lightblue",required:!0})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"content",className:"sr-only",children:"내용"}),e.jsx("textarea",{type:"text",id:"content",name:"content",placeholder:"내용을 입력해주세요",ref:h,className:"w-full py-3 px-4 min-h-[100px] border rounded-md border-gray focus:outline-none focus:border-lightblue",required:!0})]}),e.jsx(H,{className:"z-10",options:f,styles:J,ref:u,defaultValue:f[R],onChange:M,placeholder:"제주도 태그를 선택해주세요"},f[R]),e.jsx("input",{type:"text",ref:c,onChange:L,className:"w-full py-3 px-4 border rounded-md border-gray-300 focus:outline-none focus:border-lightblue",placeholder:"나만의 제주도 태그를 만들어주세요.(예: #나의_사랑_제주도)"}),e.jsx(K,{ref:{placeNameRef:i,placeAddressRef:m},place:{placeName:N,placeAddress:E},setPlace:{setPlaceName:w,setPlaceAddress:V}}),e.jsx("div",{children:N}),e.jsx("button",{type:"submit",className:"text-white font-bold bg-lightblue px-4 py-3 rounded-md hover:bg-blue",children:"수정 완료"})]})]})})]})}export{ee as default};
