import{r as t,j as e,a as R,_ as v,P as C,n as H,b as V,L as W}from"./vendor-87dae68f.js";import{p as y,u as Q}from"./index-dddebd04.js";import{P as X}from"./PageHead-90e47285.js";import{d as Y}from"./debounce-1252dfff.js";import{g as Z}from"./getPbImageURL-68fee321.js";const{kakao:S}=window;function q({address:s="제주특별자치도 제주시 공항로 2",location:o="제주국제공항"}){return t.useEffect(()=>{var l=document.getElementById("map"),m={center:new S.maps.LatLng(33.450701,126.570667),level:3},a=new S.maps.Map(l,m),g=new S.maps.services.Geocoder;g.addressSearch(s,function(c,x){if(x===S.maps.services.Status.OK){var p=new S.maps.LatLng(c[0].y,c[0].x),j=new S.maps.Marker({map:a,position:p}),N=new S.maps.InfoWindow({content:`<div style="width:150px;text-align:center;padding:6px 0;">${o}</div>`});N.open(a,j),a.setCenter(p)}})},[s,o]),e.jsx(e.Fragment,{children:e.jsx("article",{id:"map",className:"h-96 mx-[15%] my-10"})})}q.propTypes={address:R.string,location:R.string};const ee="/finalize-react-6/assets/more-5d1bd5d3.svg";function L({writer:s="작성자",comment:o="댓글입니다",commentId:l,onCommentChange:m}){const[a,g]=t.useState(!1),[c,x]=t.useState(!1),[p,j]=t.useState(o),[N,i]=t.useState(o),[h]=t.useState(()=>{const d=localStorage.getItem("user");return JSON.parse(d).state.user.username}),u=()=>{g(!a),x(!c)},r=async d=>{const w={comment:p};try{await y.collection("comment").update(d,w)}catch(f){throw new Error(f.message)}g(!1),x(!1)},b=()=>{x(!1),j(N)},O=async d=>{g(!1),v.custom(w=>e.jsx("div",{className:`${w.visible?"animate-enter":"animate-leave"} max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:e.jsxs("div",{className:"w-full flex flex-col p-5 text-center gap-10",children:[e.jsx("p",{className:"font-semibold text-lg mt-4",children:"댓글을 삭제하시겠습니까 ?"}),e.jsxs("div",{className:"flex justify-center items-center gap-5",children:[e.jsx("button",{onClick:async()=>{try{await y.collection("comment").delete(d),v.remove(w.id),m(f=>f.filter(E=>E.id!==d))}catch(f){console.error(f)}},className:"bg-lightblue focus:bg-blue text-center text-white rounded-lg px-4 py-3 leading-none",children:"삭제"}),e.jsx("button",{onClick:()=>v.remove(w.id),className:"bg-lightblue focus:bg-blue text-center text-white rounded-lg px-4 py-3 leading-none",children:"취소"})]})]})}),{duration:1/0})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"shadow-comment w-full h-fit flex justify-between gap-4 py-3 px-4",children:[e.jsx("span",{children:"⭐"}),e.jsx("div",{className:"text-darkblue font-semibold  ",children:s}),c?e.jsx("input",{type:"text",value:p,className:"grow text-start bg-lightsand",onChange:d=>j(d.target.value)}):e.jsx("p",{className:"grow text-start",children:p}),e.jsxs("div",{onClick:u,className:"shrink-0 cursor-pointer",children:[!a&&h===s&&e.jsx("img",{src:ee,alt:"more"}),a&&e.jsxs("ul",{className:"dropdown-menu flex gap-2",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>r(l),children:"수정"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>O(l),children:"삭제"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>b(),children:"취소"})})]})]})]})})}L.propTypes={writer:C.string.isRequired,comment:C.string.isRequired,commentId:C.string.isRequired,onCommentChange:C.func.isRequired};function P({contentId:s,onCommentInfoChange:o}){const[l,m]=t.useState(""),[a,g]=t.useState(""),c=t.useRef(""),[x]=t.useState(()=>{const i=localStorage.getItem("user");return JSON.parse(i).state.user.userId}),p=async()=>(await y.collection("user").getList(1,1,{expand:"comment, content",filter:`(username = '${x}')`})).items[0].id,j=Y(i=>{m(i.target.value)},500),N=async i=>{if(i.preventDefault(),!c.current.value.trim()){v("댓글을 입력해주세요.",{position:"top-right",icon:"🚨",ariaProps:{role:"alert","aria-live":"polite"}});return}if(!x){v("로그인 후 이용 가능합니다.",{position:"top-right",icon:"🚨",ariaProps:{role:"alert","aria-live":"polite"}});return}const h=await p();g(h)};return t.useEffect(()=>{if(a){const i=async r=>await y.collection("user").update(a,{"comment+":r.id}),h=async r=>await y.collection("content").update(s,{"commentId+":r.id}),u=async()=>{const r={star:!0,comment:l,contentId:s,userId:a};if(c.current.value.trim()){const b=await y.collection("comment").create(r,{expand:"userId"});m(""),c.current.value="",await h(b),await i(b),o==null||o(b)}};try{u()}catch(r){console.error(r)}}},[a,s,o,l]),e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:N,className:"grow w-full flex",children:[e.jsxs("div",{className:"flex-grow mr-2",children:[e.jsx("label",{htmlFor:"comment",className:"sr-only",children:"댓글"}),e.jsx("input",{type:"text",id:"comment",name:"comment",ref:c,defaultValue:l,placeholder:"별과 함께 이 제주에 대한 마음을 입력해주세요.",onChange:j,required:!0,className:"w-full py-3 px-4 border-2 rounded-md border-lightblue focus:outline-none focus:border-blue"})]}),e.jsx("button",{type:"submit",className:"min-w-fit px-4 py-3 bg-lightblue hover:bg-blue border-2 text-white font-bold border-lightsand rounded-md",children:"⭐ 마음 등록"})]})})}P.propTypes={contentId:C.string.isRequired,onCommentInfoChange:C.func.isRequired};function ce(){const{id:s}=H(),o=V(),{user:l}=Q(),[m,a]=t.useState(),[g,c]=t.useState(),[x,p]=t.useState(),[j,N]=t.useState(),[i,h]=t.useState(),[u,r]=t.useState([]),[b,O]=t.useState(),[d,w]=t.useState(),f=t.useRef(null),[E,D]=t.useState(),[te,$]=t.useState(),[T,F]=t.useState();t.useEffect(()=>{T&&r(n=>[...n,T])},[T]);const[M,se]=t.useState([]),U=n=>M.includes(n);t.useEffect(()=>{async function n(){try{const I=await y.collection("content").getOne(s,{expand:"commentId,commentId.userId,userId"},{requestKey:"string"}),{title:J,content:K,tag:_,customTag:z,expand:k,location:B,address:G}=I;p(Z(I,"photo")),c(K),N(_),a(J),O(B),w(G),h(z),D(s),$(I),k&&r(k.commentId),k&&(f.current=k.userId.username)}catch(I){console.error(I)}}n()},[s]);const A=async()=>{v.custom(n=>e.jsx("div",{className:`${n.visible?"animate-enter":"animate-leave"} max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,children:e.jsxs("div",{className:"w-full flex flex-col p-5 text-center gap-10",children:[e.jsx("p",{className:"font-semibold text-lg mt-4",children:"게시물을 삭제하시겠습니까 ?"}),e.jsxs("div",{className:"flex justify-center items-center gap-5",children:[e.jsx("button",{onClick:async()=>{try{await y.collection("content").delete(s),v.remove(n.id),o("/content/list")}catch(I){console.error(I)}},className:"bg-lightblue focus:bg-blue text-center text-white rounded-lg px-4 py-3 leading-none",children:"삭제"}),e.jsx("button",{onClick:()=>v.remove(n.id),className:"bg-lightblue focus:bg-blue text-center text-white rounded-lg px-4 py-3 leading-none",children:"취소"})]})]})}),{duration:1/0})};return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Jeju All in One - 나만의 제주"}),e.jsxs("section",{className:"shadow-content mt-5 mb-20 px-20 py-20 gap-5 flex flex-col items-center mx-[15%] min-h-full rounded-md",children:[e.jsx("h2",{className:"sr-only",children:m}),e.jsx("article",{className:"min-w-[400px] ",children:e.jsx("img",{src:x,alt:m,className:"w-full h-full object-cover max-h-[100vh]"})}),e.jsxs("article",{className:"w-full py-2 px-4 rounded-md border border-gray-500",children:[e.jsxs("p",{className:"pb-2 font-bold flex justify-between",children:[m,e.jsxs("span",{className:"font-light",children:["#",j," ",i&&`#${i}`]})]}),g]}),f.current!==null&&f.current===(l==null?void 0:l.userId)&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{to:`/content/edit/${s}`,children:e.jsx("button",{className:"bg-blue text-white py-2 px-4 rounded-lg",children:"수정"})}),e.jsx("button",{className:"bg-blue text-white py-2 px-4 rounded-lg",onClick:A,children:"삭제"})]})]}),e.jsx("hr",{className:"hr h-2 border-2"}),e.jsxs("section",{className:"py-20 flex flex-col justify-center text-center items-center mx-auto min-h-full max-w-[1200px]",children:[e.jsx("div",{className:"w-full flex flex-row gap-4 justify-between items-center px-[15%]",children:e.jsx(P,{contentId:s,onCommentInfoChange:F})}),(u==null?void 0:u.length)!==0&&e.jsx("div",{className:"w-full flex flex-col pt-10 px-[15%]",children:u==null?void 0:u.map(n=>U(n.id)?null:e.jsx(L,{writer:n.expand.userId.nickname,comment:n.comment,commentId:n.id,onCommentChange:r},n.id))})]}),e.jsx("hr",{}),e.jsx(q,{address:d&&d!=="null"?d:"제주특별자치도 제주시 공항로 2",location:b&&b!=="null"?b:"제주국제공항"})]})}export{ce as default};
